.TH redfishpower 8 "1 October 2021" "@PACKAGE_NAME@-@PACKAGE_VERSION@"
.SH NAME
redfishpower \- communicate with redfish service processors in parallel
.SH SYNOPSIS
.B redfishpower
.I "<--hostname hostname(s) | --hostsfile file> [OPTIONS]"
.LP
.SH DESCRIPTION
.B redfishpower
is a helper program for
.B powerman
which enables it to communicate with redfish service processors in parallel.
It is run interactively by the powerman daemon.
.SH OPTIONS
.TP
.I "-h, --hostname hostname(s)"
Set legal hostnames that redfishpower can communicate with.  Host
ranges are acceptable.  Note that the maximum number of hosts that can be
set simultaneously is limited by the file descriptor limit of the
.B select(2)
system call.
.TP
.I "-H, --header string"
Set extra HEADER to use.  Typically is Content-Type:application/json.
.TP
.I "-S, --statpath string"
Set Redfish path for obtaining power status.  Typically is redfish/v1/Systems/1.
.TP
.I "-O, --onpath string"
Set Redfish path for performing power on.  Typically is redfish/v1/Systems/1/Actions/ComputerSystem.Reset.
.TP
.I "-F, --offpath string"
Set Redfish path for performing power off.  Typically is redfish/v1/Systems/1/Actions/ComputerSystem.Reset.
.TP
.I "-C, --cyclepath string"
Set Redfish path for performing power cycle.  Typically is redfish/v1/Systems/1/Actions/ComputerSystem.Reset.
.TP
.I "-P, --onpostdata string"
Set Redfish postdata for performing power on.  Typically is {"ResetType":"On"}
.TP
.I "-G, --offpostdata string"
Set Redfish postdata for performing power off.  Typically is {"ResetType":"ForceOff"}
.TP
.I "-D, --cyclepostdata string"
Set Redfish postdata for performing power cycle.  Typically is {"ResetType":"ForceRestart"}
.TP
.I "-v, --verbose"
Increase output verbosity.
.SH INTERACTIVE COMMANDS
The following commands are accepted at the redfishpower> prompt:
.TP
.I "auth user:pass"
Authenticate to the base URL with specified user and password,
using ``basic'' HTTP authentication which sends the user and password
over the network in plain text.
.TP
.I "setheader [string data]"
Set extra HEADER to use.  Do not specify data to clear.
.TP
.I "setstatpath <path>"
Set path to obtain power status.
.TP
.I "setonpath <path> [postdata]"
Set path and optional post data to turn on node.
.TP
.I "setoffpath <path> [postdata]"
Set path and optional post data to turn off node.
.TP
.I "setcyclepath <path> [postdata]"
Set path and optional post data to cycle node.
.TP
.I "settimeout <seconds>"
Set command timeout in seconds.
.TP
.I "stat [nodes]"
Get power status of all nodes or specified subset of nodes.
.TP
.I "on [nodes]"
Turn on all nodes or specified subset of nodes.  Will return "ok" after confirmation "on" has completed.
.TP
.I "off [nodes]"
Turn off all nodes or specified subset of nodes.  Will return "ok" after confirmation "off" has completed.
.TP
.I "cycle [nodes]"
Power cycle all nodes or specified subset of nodes.

.SH "UPDATING REDFISHPOWER DEVICE FILES"
.LP
Users may often need to modify
.B redfishpower
device files for other systems, as URI paths may be slightly different.
.LP
To find the URI paths on your system, a good starting point is to
use
.B curl(1)
to discover the correct paths at the following standard location.
Note that the output can be easier to read if piped to
.B jq(1),
but that is optional.
.PP
.B # curl -s -u USER:PASS -k -X GET https://<node>/redfish/v1/Systems | jq
.LP
Information in the response will point you on how to dig further.
Several paths the authors have seen include:
.PP
.B # curl -s -u USER:PASS -k -X GET https://<node>/redfish/v1/Systems/1
.PP
.B # curl -s -u USER:PASS -k -X GET https://<node>/redfish/v1/Systems/Node0
.PP
.B # curl -s -u USER:PASS -k -X GET https://<node>/redfish/v1/Systems/Self
.LP
Internally within
.B redfishpower,
an \fIon\fR or \fIoff\fR command will not return until the
\fIon\fR/\fIoff\fR is confirmed to complete.  i.e. \fIstat\fR returns
the expected status.
.LP
This can sometimes take awhile and on some systems may push the
timeout limit specified in the device file (typically 60 seconds).  If
necessary, it should be increased at the top of the specification file
(via \fItimeout\fR) and the login section of device file (via
\fIsettimeout\fR).
.LP
Note that the
.B powerman
timeout should account for the combined time of an \fIoff\fR and \fIon\fR
for the \fIcycle\fR operation.

.SH "FILES"
@X_SBINDIR@/redfishpower
.br
@X_SYSCONFDIR@/powerman/powerman.conf

.SH "ORIGIN"
PowerMan was originally developed by Andrew Uselton on LLNL's Linux clusters.
This software is open source and distributed under the terms of the GNU GPL.

.SH "SEE ALSO"
.BR powerman (1),
.BR powermand (8),
.BR plmpower (8),
.BR vpcd (8),
.BR powerman.conf (5),
.BR powerman.dev (5).
.PP
\fBhttp://github.com/chaos/powerman\fR
